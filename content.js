var de=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ie(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}var ae={exports:{}};(function(E,p){(function(h,r){E.exports=r()})(typeof self<"u"?self:de,function(){return function(T){var h={};function r(n){if(h[n])return h[n].exports;var l=h[n]={i:n,l:!1,exports:{}};return T[n].call(l.exports,l,l.exports,r),l.l=!0,l.exports}return r.m=T,r.c=h,r.d=function(n,l,v){r.o(n,l)||Object.defineProperty(n,l,{enumerable:!0,get:v})},r.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r.t=function(n,l){if(l&1&&(n=r(n)),l&8||l&4&&typeof n=="object"&&n&&n.__esModule)return n;var v=Object.create(null);if(r.r(v),Object.defineProperty(v,"default",{enumerable:!0,value:n}),l&2&&typeof n!="string")for(var i in n)r.d(v,i,(function(S){return n[S]}).bind(null,i));return v},r.n=function(n){var l=n&&n.__esModule?function(){return n.default}:function(){return n};return r.d(l,"a",l),l},r.o=function(n,l){return Object.prototype.hasOwnProperty.call(n,l)},r.p="",r(r.s="./src/index.js")}({"./src/darkmode.js":function(T,h,r){Object.defineProperty(h,"__esModule",{value:!0}),h.default=h.IS_BROWSER=void 0;function n(m,a){if(!(m instanceof a))throw new TypeError("Cannot call a class as a function")}function l(m,a){for(var k=0;k<a.length;k++){var t=a[k];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(m,t.key,t)}}function v(m,a,k){return a&&l(m.prototype,a),k&&l(m,k),m}var i=typeof window<"u";h.IS_BROWSER=i;var S=function(){function m(a){if(n(this,m),!!i){var k={bottom:"32px",right:"32px",left:"unset",time:"0.3s",mixColor:"#fff",backgroundColor:"#fff",buttonColorDark:"#100f2c",buttonColorLight:"#fff",label:"",saveInCookies:!0,autoMatchOsTheme:!0};a=Object.assign({},k,a);var t=`
      .darkmode-layer {
        position: fixed;
        pointer-events: none;
        background: `.concat(a.mixColor,`;
        transition: all `).concat(a.time,` ease;
        mix-blend-mode: difference;
      }

      .darkmode-layer--button {
        width: 2.9rem;
        height: 2.9rem;
        border-radius: 50%;
        right: `).concat(a.right,`;
        bottom: `).concat(a.bottom,`;
        left: `).concat(a.left,`;
      }

      .darkmode-layer--simple {
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        transform: scale(1) !important;
      }

      .darkmode-layer--expanded {
        transform: scale(100);
        border-radius: 0;
      }

      .darkmode-layer--no-transition {
        transition: none;
      }

      .darkmode-toggle {
        background: `).concat(a.buttonColorDark,`;
        width: 3rem;
        height: 3rem;
        position: fixed;
        border-radius: 50%;
        border:none;
        right: `).concat(a.right,`;
        bottom: `).concat(a.bottom,`;
        left: `).concat(a.left,`;
        cursor: pointer;
        transition: all 0.5s ease;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .darkmode-toggle--white {
        background: `).concat(a.buttonColorLight,`;
      }

      .darkmode-toggle--inactive {
        display: none;
      }

      .darkmode-background {
        background: `).concat(a.backgroundColor,`;
        position: fixed;
        pointer-events: none;
        z-index: -10;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
      }

      img, .darkmode-ignore {
        isolation: isolate;
        display: inline-block;
      }

      @media screen and (-ms-high-contrast: active), (-ms-high-contrast: none) {
        .darkmode-toggle {display: none !important}
      }

      @supports (-ms-ime-align:auto), (-ms-accelerator:true) {
        .darkmode-toggle {display: none !important}
      }
    `),g=document.createElement("div"),I=document.createElement("button"),q=document.createElement("div");I.innerHTML=a.label,I.classList.add("darkmode-toggle--inactive"),g.classList.add("darkmode-layer"),q.classList.add("darkmode-background");var B=window.localStorage.getItem("darkmode")==="true",D=a.autoMatchOsTheme&&window.matchMedia("(prefers-color-scheme: dark)").matches,F=window.localStorage.getItem("darkmode")===null;(B===!0&&a.saveInCookies||F&&D)&&(g.classList.add("darkmode-layer--expanded","darkmode-layer--simple","darkmode-layer--no-transition"),I.classList.add("darkmode-toggle--white"),document.body.classList.add("darkmode--activated")),document.body.insertBefore(I,document.body.firstChild),document.body.insertBefore(g,document.body.firstChild),document.body.insertBefore(q,document.body.firstChild),this.addStyle(t),this.button=I,this.layer=g,this.saveInCookies=a.saveInCookies,this.time=a.time}}return v(m,[{key:"addStyle",value:function(k){var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),t.setAttribute("href","data:text/css;charset=UTF-8,"+encodeURIComponent(k)),document.head.appendChild(t)}},{key:"showWidget",value:function(){var k=this;if(i){var t=this.button,g=this.layer,I=parseFloat(this.time)*1e3;t.classList.add("darkmode-toggle"),t.classList.remove("darkmode-toggle--inactive"),t.setAttribute("aria-label","Activate dark mode"),t.setAttribute("aria-checked","false"),t.setAttribute("role","checkbox"),g.classList.add("darkmode-layer--button"),t.addEventListener("click",function(){var q=k.isActivated();q?(g.classList.remove("darkmode-layer--simple"),t.setAttribute("disabled",!0),setTimeout(function(){g.classList.remove("darkmode-layer--no-transition"),g.classList.remove("darkmode-layer--expanded"),t.removeAttribute("disabled")},1)):(g.classList.add("darkmode-layer--expanded"),t.setAttribute("disabled",!0),setTimeout(function(){g.classList.add("darkmode-layer--no-transition"),g.classList.add("darkmode-layer--simple"),t.removeAttribute("disabled")},I)),t.classList.toggle("darkmode-toggle--white"),document.body.classList.toggle("darkmode--activated"),window.localStorage.setItem("darkmode",!q)})}}},{key:"toggle",value:function(){if(i){var k=this.layer,t=this.isActivated(),g=this.button;k.classList.toggle("darkmode-layer--simple"),document.body.classList.toggle("darkmode--activated"),window.localStorage.setItem("darkmode",!t),g.setAttribute("aria-label","De-activate dark mode"),g.setAttribute("aria-checked","true")}}},{key:"isActivated",value:function(){return i?document.body.classList.contains("darkmode--activated"):null}}]),m}();h.default=S},"./src/index.js":function(T,h,r){Object.defineProperty(h,"__esModule",{value:!0}),h.default=void 0;var n=l(r("./src/darkmode.js"));function l(i){if(i&&i.__esModule)return i;var S={};if(i!=null){for(var m in i)if(Object.prototype.hasOwnProperty.call(i,m)){var a=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(i,m):{};a.get||a.set?Object.defineProperty(S,m,a):S[m]=i[m]}}return S.default=i,S}var v=n.default;h.default=v,n.IS_BROWSER&&function(i){i.Darkmode=n.default}(window),T.exports=h.default}})})})(ae);var ce=ae.exports;const se=ie(ce);chrome.storage.local.get("options",E=>{let p=E.options;p===void 0&&(p={sideMenu:"0",timetableButton:"0",headerName:"0",themeButton:"0",noticeFold:"0",taskList:"0",taskListSubmitted:"0",addSchedule:"0",deleteWorkRule:"0"},chrome.storage.local.set({options:p})),console.log(p);const T=setInterval(J,1),h=setInterval(Z,1),r=setInterval(G,1),n=setInterval(K,1),l=setInterval(Q,1),v=setInterval(ee,1),i=setInterval(V,1),S=setInterval(X,1),m=setInterval(te,1),a=setInterval(ne,1),t=window.location.pathname.includes("timetable");let g=!1,I=!1,q=!1,B=!1,D=!1,F=!1,j=!1,W=!1,z=!1,U=!1;document.onreadystatechange=()=>{if(document.readyState==="complete"){if(p.themeButton=="0"){const e={time:"0s",mixColor:"#fff",backgroundColor:"#fff",buttonColorDark:"#100f2c",buttonColorLight:"#fff",label:"&#x262f;"};new se(e).showWidget()}oe(),g||J(),I||K(),q||ee(),B||X(),D||V(),F||Q(),j||Z(),W||G(),z||te(),U||ne()}};function oe(){clearInterval(T),clearInterval(n),clearInterval(h),clearInterval(r),clearInterval(l),clearInterval(v),clearInterval(i),clearInterval(S),clearInterval(m),clearInterval(a)}function X(){var d;const e=document.querySelector(".div-table.contents-detail");if((!t||t&&e!=null)&&(clearInterval(S),B=!0,e!=null&&p.addSchedule=="0")){const o=["A2","W","W","S1","S1","S2","S2","S2","S2","A1","A1","A2"],u=(R=>new URLSearchParams(window.location.search).get(R))("selectDisplayMode")??"",y=u==""||u=="0",b=(d=document.querySelector(".timetable-today-btn-area a"))==null?void 0:d.textContent,L=u=="1"&&b=="月表示",w=u=="1"&&b=="週表示",_=new Date,x=(y?document.querySelector("#nendo option[selected]"):document.getElementsByName("selectNendo")[0].querySelector("option[selected]")).value,A=y?document.querySelector("#kikanCd option[selected]").textContent:o[parseInt(document.getElementsByName("selectMonth")[0].querySelector("option[selected]").value)-1],H={year:x==""?_.getFullYear():x,semester:A==""?o[_.getMonth()]:A};console.log(`Target Period: ${H.year} ${H.semester}`),chrome.storage.local.get(null,R=>{Object.values(R).forEach(c=>{if(c.year!=H.year||!H.semester.includes(c.period)&&c.period!="X")return;console.log(c);let $,f;if(y){$=e.children[parseInt(c.time)].children[parseInt(c.day)],f=document.createElement("div"),f.dataset.day=c.day,f.dataset.time=c.time,f.classList.add("clearfix");const C=document.createElement("div");C.classList.add("schedule-title"),C.innerHTML=c.title;const M=document.createElement("div");M.classList.add("schedule-detail"),M.innerHTML=c.content,f.appendChild(C),f.appendChild(M)}else if(L){if(e.querySelectorAll(".div-table-data-row")[0].querySelector(`div:nth-child(${c.day+2}):has(span)`)==null)return;$=e.children[c.time+1].children[c.day+1],f=document.createElement("div"),f.dataset.day=c.day,f.dataset.time=c.time,f.classList.add("clearfix");const C=document.createElement("div");C.classList.add("calendar-course-list","bold-txt","break");const M=O=>O.replace(/[A-Za-z0-9]/g,function(N){return String.fromCharCode(N.charCodeAt(0)+65248)});C.innerHTML=`<div class="bold-txt" style="cursor: pointer;">${M(String(c.time))}時限 ${c.title}</div>`,f.appendChild(C)}else if(w){e.querySelectorAll(`.div-table-data-row div:nth-child(${c.day+1}):has(span)`).forEach(M=>{f=document.createElement("div"),f.dataset.day=c.day,f.dataset.time=c.time,f.classList.add("clearfix");const O=document.createElement("div");O.classList.add("calendar-course-list","bold-txt","break");const N=P=>P.replace(/[A-Za-z0-9]/g,function(re){return String.fromCharCode(re.charCodeAt(0)+65248)});O.innerHTML=`<div class="bold-txt" style="cursor: pointer;">${N(String(c.time))}時限 ${c.title}</div>`,f.appendChild(O),f.addEventListener("click",P=>{Y(P.currentTarget.dataset.day,P.currentTarget.dataset.time)}),M.appendChild(f)});return}else return;f.addEventListener("click",C=>{Y(C.currentTarget.dataset.day,C.currentTarget.dataset.time)}),$.appendChild(f)})})}}function le(e,d){const o=document.createElement("div");o.tabIndex=-1,o.role="dialog",o.classList.add("ui-dialog","ui-corner-all","ui-widget","ui-widget-content","ui-front","schedule-dialog"),o.setAttribute("aria-describedby","progress_dialog"),o.setAttribute("aria-labelledby","ui-id-1");const s=document.createElement("div");s.setAttribute("style","margin: 7.5px 15px; padding: 7.5px 0; font-size: 15px; text-align: center; font-weight: bold; background-color: #96c1ea;"),s.innerHTML="予定を削除";const u=document.createElement("div");u.classList.add("schedule-dialog-content"),u.innerHTML=`<span style="font-weight: bold; margin-top: 15px;">${d}</span><span>を削除してもよろしいですか？</span>`;const y=document.createElement("div");y.setAttribute("style","display: flex; justify-content: center; margin-top: 15px;");const b=document.createElement("input");b.type="button",b.classList.add("schedule-dialog-btn"),b.value="キャンセル",b.addEventListener("click",()=>{document.querySelector(".schedule-dialog").remove(),document.querySelector(".schedule-dialog-overlay").remove()}),y.appendChild(b);const L=document.createElement("input");L.type="button",L.classList.add("schedule-dialog-btn"),L.value="削除する",L.addEventListener("click",()=>{chrome.storage.local.remove(e).then(()=>{document.querySelector(".schedule-dialog").remove(),document.querySelector(".schedule-dialog-overlay").remove(),window.location.reload()})}),y.appendChild(L),u.appendChild(y),o.appendChild(s),o.appendChild(u),document.body.appendChild(o);const w=document.createElement("div");w.classList.add("ui-widget-overlay","ui-front","schedule-dialog-overlay"),w.style.zIndex="100",document.body.appendChild(w)}function Y(e,d){const o=document.createElement("div");o.tabIndex=-1,o.role="dialog",o.classList.add("ui-dialog","ui-corner-all","ui-widget","ui-widget-content","ui-front","schedule-dialog"),o.setAttribute("aria-describedby","progress_dialog"),o.setAttribute("aria-labelledby","ui-id-1");const s=document.createElement("div");s.classList.add("schedule-dialog-title"),s.setAttribute("style","margin: 7.5px 15px; padding: 7.5px 0; font-size: 15px; text-align: center; font-weight: bold; background-color: #96c1ea;"),s.innerHTML="予定詳細";const u=`schedule_${e}_${d}`;chrome.storage.local.get(u).then(y=>{let b=y[u];const L=document.createElement("div");L.classList.add("schedule-dialog-content"),L.innerHTML=`     <div class="schedule-item-list">       <div class="schedule-item">         <div class="schedule-item-title">タイトル</div>         <div class="schedule-item-content">${b.title}</div>       </div>       <div class="schedule-item">         <div class="schedule-item-title">内容</div>         <div class="schedule-item-content">${b.content}</div>       </div>     </div>   `;const w=document.createElement("div");w.setAttribute("style","display: flex; justify-content: center; margin-top: 15px;");const _=document.createElement("input");_.type="button",_.classList.add("schedule-dialog-btn"),_.value="この予定を削除",_.addEventListener("click",()=>{document.querySelector(".schedule-dialog").remove(),document.querySelector(".schedule-dialog-overlay").remove(),le(u,b.title)}),w.appendChild(_);const x=document.createElement("input");x.type="button",x.classList.add("schedule-dialog-btn"),x.value="閉じる",x.addEventListener("click",()=>{document.querySelector(".schedule-dialog").remove(),document.querySelector(".schedule-dialog-overlay").remove()}),w.appendChild(x),L.appendChild(w),o.appendChild(s),o.appendChild(L),document.body.appendChild(o);const A=document.createElement("div");A.classList.add("ui-widget-overlay","ui-front","schedule-dialog-overlay"),A.style.zIndex="100",document.body.appendChild(A)})}function J(){const e=document.querySelector("#sidemenu"),d=document.querySelector("#pageMain");e!=null&&d!=null&&(clearInterval(T),g=!0,p.sideMenu=="0"&&(e.classList.add("sidemenu-close"),document.querySelector("#pageMain").classList.add("sidemenu-hide"),document.querySelector("#sidemenuOpen").classList.remove("sidemenu-open"),document.querySelector("#sidemenuOpen").setAttribute("aria-expanded","false")))}function Z(){const e=document.querySelector(".emgHeader");(!t||t&&e!=null)&&(clearInterval(h),j=!0,e!=null&&p.noticeFold=="0"&&(j=!0,e.classList.add("noticeFold"),document.querySelector("#emgInformation").classList.add("noticeFold"),e.addEventListener("click",()=>{document.querySelector("#emgInformation").classList.toggle("emgActive"),e.classList.toggle("emgActive")})))}function G(){const e=document.querySelector(".impHeader");(!t||t&&e!=null)&&(clearInterval(r),W=!0,e!=null&&p.noticeFold=="0"&&(W=!0,e.classList.add("noticeFold"),document.querySelector("#impInformation").classList.add("noticeFold"),e.addEventListener("click",()=>{document.querySelector("#impInformation").classList.toggle("impActive"),e.classList.toggle("impActive")})))}function K(){const e=document.querySelector(".page-head-notification-area"),d=document.querySelector("#page_head.page-head .page-head-navi");if((e!=null||d!=null)&&(clearInterval(n),I=!0,p.timetableButton=="0")){const o=chrome.runtime.getURL("images/head_icon_timetable.png"),s=document.createElement(e!=null?"li":"div");s.classList.add(e!=null?"header-timetable":"header-timetable2"),s.innerHTML=`<a href="https://utol.ecc.u-tokyo.ac.jp/lms/timetable?selectDisplayMode=0" class="btn-header-timetable"><img class="header-img" src="${o}" alt="時間割"></a>`,e!=null?e.appendChild(s):d.before(s)}}function Q(){const e=document.querySelector(".timetable-other-course");(!t||t&&e!=null)&&(clearInterval(l),F=!0,e!=null&&p.deleteWorkRule=="0"&&e.querySelectorAll(".div-table-cell-row").forEach(o=>{o.querySelector(".timetable-course-top-btn").textContent.includes("ワークルール")&&(o.style.display="none")}))}function V(){const e=document.querySelector("#selectTimetable .timetable-color");if((!t||t&&e!=null)&&(clearInterval(i),D=!0,e!=null&&p.addSchedule=="0")){const d=e.querySelector(".timetable-icon");d!=null&&d.classList.add("timetable-icon-hide");const o=document.createElement("input");o.type="button",o.value="予定を追加",o.classList.add("mode-btn","false","add-schedule-btn"),o.addEventListener("click",()=>{let u=window.screen.availWidth*.6,y=window.screen.availHeight*.6,b="width="+u+", height="+y;typeof window.screenX<"u"?b+=", screenX="+(window.screenX+(window.screen.availWidth-u)/2)+", screenY="+(window.screenY+(window.screen.availHeight-y)/2):typeof window.screenLeft<"u"&&(b+=", left="+(window.screenLeft+(window.screen.availWidth-u)/2)+", top="+(window.screenTop+(window.screen.availHeight-y)/2)),window.open(chrome.runtime.getURL("add_schedule/add_schedule.html"),"予定の追加",b),window.addEventListener("message",L=>{const w=L.data,x={[`schedule_${w.day}_${w.time}`]:w};chrome.storage.local.set(x).then(()=>{chrome.storage.local.get(null,A=>{console.log(A)}),window.location.reload()})})});const s=e.querySelector(".timetable-title");s.classList.add("addSchedule"),s.appendChild(o)}}async function ee(){const e=document.querySelector("#selectTimetable");t&&e!=null&&(clearInterval(v),q=!0,p.taskList=="0"&&fetch("https://utol.ecc.u-tokyo.ac.jp/lms/task").then(d=>d.text()).then(d=>{const s=new DOMParser().parseFromString(d,"text/html").querySelector(".block.clearfix");s.querySelectorAll(".contents-display-flex.contents-display-flex-exchange-sp.sortBlock.result_list_line").forEach(y=>{y.querySelector(".contents-hidden.status").textContent=="1"&&p.taskListSubmitted=="0"&&y.classList.add("tasklist-submitted")});const u=document.createElement("div");u.classList.add("task-table-wrapper"),u.appendChild(s),e.before(u)}))}function te(){const e=document.querySelector(".page-top-btn");e!=null&&(clearInterval(m),z=!0,p.timetableButton=="0"&&e.classList.add("page-top-btn-hide"))}function ne(){const e=document.querySelector(".page-head-navi-list .page-head-userinfo"),d=document.querySelector(".page-head-navi-list .header-user-name");(e!=null||d!=null)&&(clearInterval(a),U=!0,p.headerName=="0"&&(e??d).classList.add("page-head-userinfo-hide"))}});
